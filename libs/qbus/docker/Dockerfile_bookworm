FROM debian:12-slim

RUN apt-get update && apt-get install -y \
  gcc \
  g++ \
  git \
  cmake \
  default-libmysqlclient-dev \
  libsqlite3-dev \
  libpcre3-dev \
#  libcurl4-openssl-dev \
  libssl-dev \
  libnss3 \
  locales \
  libglib2.0-0 \
  uuid-dev \
  libxml2-dev \
  libpsl-dev \
  && rm -rf /val/lib/apt/lists/*

# clone current libcurl
RUN git clone https://github.com/curl/curl.git /usr/src/curl

# install libcurl from sources, see issue
# https://github.com/curl/curl/issues/18448
RUN cd /usr/src/curl \
 && ./configure --disable-socketpair \
 && make
 && make install

ARG CACHEBUST=1
