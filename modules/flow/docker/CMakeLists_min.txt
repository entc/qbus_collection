cmake_minimum_required(VERSION 2.9)

PROJECT(qmod_flow)

SET(CMAKE_POSITION_INDEPENDENT_CODE ON)                         # activates -fPic on linux
SET(CMAKE_MACOSX_RPATH 0)                                       # strip away rpath
SET(CMAKE_BUILD_TYPE Release)                                     # build type
SET(CMAKE_ENABLE_EXPORTS ON)
SET(CMAKE_VERBOSE_MAKEFILE OFF)

if (CMAKE_VERSION VERSION_LESS "3.1")
    if (CMAKE_CXX_COMPILER_ID STREQUAL "GNU")
      set (CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=gnu++11")
    endif ()
else ()
  set (CMAKE_CXX_STANDARD 11)
endif ()

SET(CMAKE_INSTALL_PREFIX /opt/)

# basic libs
ADD_SUBDIRECTORY(qbus_collection/libs/cape/src)
ADD_SUBDIRECTORY(qbus_collection/libs/adbl/src)
ADD_SUBDIRECTORY(qbus_collection/libs/qbus/src)
ADD_SUBDIRECTORY(qbus_collection/libs/qcrypt/src)
ADD_SUBDIRECTORY(qbus_collection/libs/qflow/src)
ADD_SUBDIRECTORY(qbus_collection/libs/qjobs/src)
ADD_SUBDIRECTORY(qbus_collection/libs/qtee/src)

# tools
ADD_SUBDIRECTORY(qbus_collection/tools/cldd/src)
ADD_SUBDIRECTORY(qbus_collection/tools/healthcheck/src)
ADD_SUBDIRECTORY(qbus_collection/tools/execsec/src)

# module
ADD_SUBDIRECTORY(qbus_collection/modules/flow/src)

INSTALL(CODE "execute_process(COMMAND bash -c \"${TOOL_CLDD} ${CMAKE_CURRENT_BINARY_DIR}/qbus_collection/modules/flow/src/${CMAKE_CFG_INTDIR}/qbus_mod_flow ${CMAKE_CURRENT_BINARY_DIR}/image_gen -uid 1000 -gid 1000\")")
INSTALL(CODE "execute_process(COMMAND bash -c \"${TOOL_CLDD} ${PVD_QBUS_DIR}/libqbus_pvd_mqtt.so ${CMAKE_CURRENT_BINARY_DIR}/image_gen -uid 1000 -gid 1000 -p qbus\")")
INSTALL(CODE "execute_process(COMMAND bash -c \"${TOOL_CLDD} ${PVD_ADBL_DIR}/libadbl2_mysql.so ${CMAKE_CURRENT_BINARY_DIR}/image_gen -uid 1000 -gid 1000 -p adbl\")")
INSTALL(CODE "execute_process(COMMAND bash -c \"${TOOL_CLDD} ${TOOL_HEALTHCHECK} ${CMAKE_CURRENT_BINARY_DIR}/image_gen -uid 1000 -gid 1000\")")
INSTALL(CODE "execute_process(COMMAND bash -c \"${TOOL_CLDD} ${TOOL_EXECSEC} ${CMAKE_CURRENT_BINARY_DIR}/image_gen -uid 1000 -gid 1000\")")
